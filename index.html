<html>
  <head>
    <title>Payment Method Identifiers</title>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common'
            async class='remove'></script>
    <script class='remove'>
      var respecConfig = {
          shortName:  "payment-method-id",
          edDraftURI:   "http://w3c.github.io/webpayments-method-identifiers/",

          specStatus: "ED",
          editors: [
                {   name:       "Adrian Bateman",
                    company:    "Microsoft Corporation" },
                {   name:       "Zach Koch",
                    company:    "Google" },
                {   name:       "Roy McElmurry",
                    company:    "Facebook" },
          ],

          license:      "w3c-software-doc",

          previousMaturity: "FPWD",
          previousPublishDate:  "2016-04-21",

          wg:           "Web Payments Working Group",
          wgURI:        "https://www.w3.org/Payments/WG/",
          wgPublicList: "public-payments-wg",
          wgPatentURI:  "https://www.w3.org/2004/01/pp-impl/83744/status",

          issueBase:    "https://github.com/w3c/webpayments-method-identifiers/issues/",

          localBiblio:  {
              "PAYMENT-REQUEST-API": {
                  title:    "Payment Request API"
              ,   href:     "https://www.w3.org/TR/payment-request/"
              ,   authors:  [
                      "Adrian Bateman"
                  ,   "Zach Koch"
                  ,   "Roy McElmurry"
                  ]
              ,   status:   "WD"
              },
              "BASIC-CARD-PAYMENT": {
                  title:    "Basic Card Payments"
              ,   href:     "https://w3c.github.io/webpayments-methods-card/"
              ,   authors:  [
                      "Adrian Bateman"
                  ,   "Zach Koch"
                  ,   "Richard Barnes"
                  ,   "Roy McElmurry"
                  ]
              },
              "SEPA-CREDIT-TRANSFER": {
                  title:    "SEPA Credit Transfer"
              ,   href:     "http://w3c.github.io/webpayments-methods-credit-transfer-direct-debit/"
              ,   authors:  [
                      "Cyril Vignet"
                  ,   "Matt Saxon"
                  ]
              },
              "PAYMENT-APPS": {
                  title:    "Payment App API"
              ,   href:     "https://w3c.github.io/webpayments-payment-apps-api/"
              ,   authors:  [
                      "Adrian Hope-Bailie"
                  ,   "Tommy Thorsen"
                  ,   "Adam Roach"
                  ,   "Jason Normore"
                  ,   "Ian Jacobs"
                  ]
              ,   status:   "WD"
              },
              "REVERSE-DOMAINS": {
                  title:    "Reverse Domain Name Notation"
              ,   href:     "https://en.wikipedia.org/wiki/Reverse_domain_name_notation"
              }
          },
          otherLinks: [{
            key: "Version control",
            data: [{
              value: "Github Repository",
              href: "https://github.com/w3c/webpayments-method-identifiers"
            }, {
              value: "Issues",
              href: "https://github.com/w3c/webpayments-method-identifiers/issues"
            }]
          }]
      };
    </script>
  </head>
  <body>
    <section id='abstract'>
      <p>
        The Payment Request API [[!PAYMENT-REQUEST-API]] requires that merchants supply a list
        of identifiers for supported payment methods. This document defines those identifier
        strings and how they are created.
      </p>
    </section>

    <section id='sotd'>
      <p>
        The working group maintains <a href="https://github.com/w3c/webpayments-method-identifiers/issues">a
        list of all bug reports that the group has not yet addressed</a>.
        This draft highlights some of the pending issues that are still to be discussed in the working
        group. No decision has been taken on the outcome of these issues including whether they are valid.
        Pull requests with proposed specification text for outstanding issues are strongly encouraged.
      </p>
      <p>
        This specification was derived from a report published previously by the
        <a href="https://www.w3.org/community/wicg/">Web Platform Incubator Community Group</a>.
      </p>
    </section>

    <section class='informative'>
      <h2>Introduction</h2>
        <p>
          One of the principles of the PaymentRequest API is that merchants must know how to accept payments from the payment methods that they claim to support.
          This allows the API to abstract away the details of specific payment methods and to add new ones over time without changing the API specification.
        </p>
        <p>
          As part of the paymentRequest() call, the web page provides an array of strings that identify the supported payment methods. This document defines those strings.
        </p>
    </section>

    <section>
      <h2>Dependencies</h2>
      <p>This specification relies on several other underlying specifications.</p>
      <dl>
        <dt>URL</dt>
        <dd>The terms <dfn>URL</dfn>, <dfn>absolute URL</dfn>, <dfn>base URL</dfn>, <dfn>URL parser</dfn>, and <dfn>URL equivalence</dfn> are defined by [[!url-1-20141209]] <small><em>(or the editor's draft)</em></small>.</dd>
      </dl>
      <div class="issue" title="Do we need a reference to some URN spec?">
        <p>Do we need a reference to some URN spec?</p>
      </div>
    </section>

    <section>
      <h2>Payment Method Identifier</h2>
      <p>
        The <dfn>Payment Method Identifier</dfn> is a string that uniquely identifies a payment method that a user can use to complete a transaction. For example, Visa, MasterCard, and American Express are payment methods used in some countries. These identifiers are split into two categories that take different forms.
      </p>

      <section>
        <h2>Open Identifier Format</h2>
        <p>Ubiquitous payment methods such as [[!BASIC-CARD-PAYMENT]] and [[!SEPA-CREDIT-TRANSFER]] are documented by the Web Payments Working Group through corresponding paymenth method specifications that also describe the inputs and outputs of those payment methods. Each open payment method is identified by a URN. This URN is purely an identifier, it does not resolve to anything. Open payment method identifiers should have the format:</p>
        <pre class="example highlight">
urn:payment-method:{name}
        </pre>
        <p>where <em>name</em> is the payment method's name. Any changes made to these payment methods over time must be approved by consensus of the Web Payments Working Group.</p>
      </section>

      <section>
        <h2>Proprietary Identifier Format</h2>
        <p>Many payment methods are naturally proprietary. Only one party is able to process payments with that payment method. These payment methods are not documented by the Web Payments Working group through formally published payment method specifications. It is instead the responsibility of the party supporting that payment method to define its behavior and input and output data.</p>
        <p>These proprietary payment methods are identified with an absolute URL.</p>
        <pre class="example highlight">
https://roypay.foo/pay
        </pre>
        <p>By default, [[!PAYMENT-APPS]] other than those associated with the identifying origin cannot claim to offer support for these payment methods. For example, <em>http://bobpay.xyz/pay</em> cannot support the paymeth method identified by <em>https://roypay.foo/pay</em>. Payment mediators must not recognize payment app as supporting a proprietary payment method unless the payment app originates from the same origin as the payment method identifier.</p>
      </section>

      <section>
        <h2>Identifier equivalence</h2>
        <p>When the PaymentRequest API is invoked, the web page provides a list of identifiers for supported payment methods.
        The user agent must compare these identifiers to those available to the user and use this to filter what the user
        can select. To determine whether two identifiers match, perform the following test:</p>
        <ul>
          <li>Let <em>A</em> be the first payment method identifier string and let <em>B</em> be the second payment method
          identifier string.</li>
          <li>Let <em>urlA</em> be the result from the <a>URL parser</a> when parsing <em>A</em> with
          no <a>base URL</a>.</li>
          <li>Let <em>urlB</em> be the result from the <a>URL parser</a> when parsing <em>B</em> with
          no <a>base URL</a></li>
          <li>The identifiers match if <em>urlA</em> <strong>equals</strong> <em>urlB</em> using the
          <a>URL equivalence</a> test (i.e. the test returns true).</li>
        </ul>
      </section>
    </section>

    <section class="appendix">
      <h2>Issues</h2>

      <p>The following issues are tracking aspects of the payment method identifier specification:</p>

      <div class="issue" data-number="3" title="Does the absolute URL resolve to any useful data">
        <p>This proposal does not necessarily assume that anything should exist at the identifying URL, but it is probably <strong>really useful</strong> to do so. The WG should consider standardizing what this optional thing could look like (e.g. a manifest file containing information about the payment method).</p>
        <p>The benefit of the above approach is that it provides a mechanism for the identifying origin to assert what other origins could potentially also support that payment method.</p>
        <p>For example, let's say that RoyPay is a proprietary payment method, but RoyPay has struck a deal with AlicePay to also allow AlicePay to return back valid RoyPay payment responses. We could define a mechanism to support this within the manifest file located at roypay.foo/pay:</p>
        <pre>
{
  name: 'http://roypay.foo/pay',
  supportedOrigins: ['https://alicepay.xyz'],
}
        </pre>
      </div>
    </section>

  </body>
</html>
