<!DOCTYPE html>
<html>
  <head>
    <title>
      Payment Method Identifiers
    </title>
    <meta charset='utf-8'>
    <script src='https://www.w3.org/Tools/respec/respec-w3c-common' async
    class='remove'></script>
    <script class='remove'>
    var respecConfig = {
      shortName: "payment-method-id",
      edDraftURI: "http://w3c.github.io/webpayments-method-identifiers/",
      specStatus: "ED",
      editors: [{
        name: "Adrian Bateman",
        company: "Microsoft Corporation",
        w3cid: 42763,
      }, {
        name: "Zach Koch",
        company: "Google",
        w3cid: 76588,
      }, {
        name: "Roy McElmurry",
        company: "Facebook",
        w3cid: 88345,
      }, {
        name: "Marcos CÃ¡ceres",
        company: "Mozilla",
        w3cid: 39125,
      }],
      license: "w3c-software-doc",
      previousMaturity: "FPWD",
      previousPublishDate: "2016-04-21",
      wg: "Web Payments Working Group",
      wgURI: "https://www.w3.org/Payments/WG/",
      wgPublicList: "public-payments-wg",
      wgPatentURI: "https://www.w3.org/2004/01/pp-impl/83744/status",
      issueBase: "https://github.com/w3c/webpayments-method-identifiers/issues/",
      otherLinks: [{
        key: "Version control",
        data: [{
          value: "Github Repository",
          href: "https://github.com/w3c/webpayments-method-identifiers"
        }, {
          value: "Issues",
          href: "https://github.com/w3c/webpayments-method-identifiers/issues"
        }]
      }]
    };
    </script>
  </head>
  <body>
    <section id='abstract'>
      <p>
        The <a data-cite="payment-request">Payment Request API</a> requires
        that merchants supply a list of identifiers for supported payment
        methods. This specification defines those identifier strings and how
        they are created, validated, matched, compared, and, where applicable,
        formally registered with the <a href="https://w3.org">W3C</a>.
      </p>
    </section>
    <section id='sotd'>
      <p>
        The working group maintains <a href=
        "https://github.com/w3c/webpayments-method-identifiers/issues">a list
        of all bug reports that the group has not yet addressed</a>. This draft
        highlights some of the pending issues that are still to be discussed in
        the working group. No decision has been taken on the outcome of these
        issues including whether they are valid. Pull requests with proposed
        specification text for outstanding issues are strongly encouraged.
      </p>
      <p>
        This specification was derived from a report published previously by
        the <a href="https://www.w3.org/community/wicg/">Web Platform Incubator
        Community Group</a>.
      </p>
    </section>
    <section class='informative'>
      <h2>
        Introduction
      </h2>
      <p>
        To use the <a data-cite="payment-request">Payment Request API</a>,
        merchants (or their service providers) need know how to handle payment
        method specific data for those methods they claim to accept. This
        allows the API to abstract away the details of specific payment methods
        and to add new ones over time without changing the <abbr title=
        "application programming interface">API</abbr>.
      </p>
      <p>
        As part of using the <a data-cite="payment-request">Payment Request
        API</a>, the Web page provides an array of strings that identify
        accepted payment methods. This specification defines those strings.
      </p>
    </section>
    <section>
      <h2>
        Dependencies
      </h2>
      <p>
        This specification relies on several other underlying specifications.
      </p>
      <dl>
        <dt>
          Secure Contexts
        </dt>
        <dd>
          The [[!SECURE-CONTEXTS]] defines the algorithm to check if a URL is a
          <dfn data-cite=
          "!SECURE-CONTEXTS#potentially-trustworthy-url">potentially
          trustworthy URL</dfn>.
        </dd>
        <dt>
          <cite>URL Standard</cite>
        </dt>
        <dd>
          The [[!URL]] standard defines the concepts of <dfn data-cite=
          "URL#concept-url" data-lt="URLs">URL</dfn>, <dfn data-cite=
          "!URL#concept-base-url">base URL</dfn>, <dfn data-cite=
          "!URL#concept-url-parser" data-lt="parse">URL parser</dfn>,
          <dfn data-cite="!URL#concept-url-equals" data-lt="equals">URL
          equivalence</dfn>, <dfn data-cite="!URL#concept-scheme">scheme</dfn>,
          <dfn data-cite="!URL#concept-url-query">query</dfn>, and
          <dfn data-cite="!URL#concept-url-fragment">fragment</dfn>.
        </dd>
        <dt>
          <cite>Web IDL</cite>
        </dt>
        <dd>
          The [[!WebIDL]] specification defines how to <dfn data-cite=
          "!WEBIDL-LS#dfn-throw">throw</dfn> an exception. It also defines
          <code><dfn data-lt="!WEBIDL-LS#idl-DOMString">DOMString</dfn></code>.
        </dd>
      </dl>
    </section>
    <section>
      <h2>
        Payment method identifiers
      </h2>
      <p>
        A <dfn>payment method identifier</dfn> is either a <a>standardized
        payment method identifier</a> or a <a>URL</a> that is valid as per the
        <a>validate a URL-based payment method identifier</a> algorithm.
      </p>
    </section>
    <section>
      <h2>
        URLs as Payment Method Identifiers
      </h2>
      <p>
        Anyone can use a <a>URL</a> as a payment method identifier, as long as
        it is <a>valid</a> as per the algorithm defined by this specification.
        This has the following advantages:
      </p>
      <ol>
        <li>Identifier decentralization.
        </li>
        <li>Origins as a trust mechanism.
        </li>
      </ol>
      <div class="issue" title=
      "Payment method manifest specification in progress">
        The <a href="https://www.w3.org/Payments/WG/">Web Payments Working
        Group</a> is developing a payment method manifest specification for the
        information a payment method owner would want to publish. Payment
        method identifiers that are URLs will help user agents locate these
        manifest files using a mechanism defined in that specification.
        <a href="https://github.com/zkoch/zkoch.github.io/blob/master/payment-manifest.md">
        Payment Manifest Proposal</a>.
      </div>
      <div class="issue" title="URL maintenance and performance">
        Either in the payment method manifest specification or in separate
        "good practice" documentation, the Working Group should address issues
        of server performance for payment method identifiers that are URLs.
        Furthermore, when parties feel they do not need to publish a manifest,
        we should explain that a manifest with an explicit machine-readable
        assertion that "any payment app may implement" is preferable to lack of
        a manifest.
      </div>
      <section>
        <h2>
          Validation
        </h2>
        <p>
          The steps to <dfn data-lt="validate|valid">validate a URL-based
          payment method identifier</dfn> are given by the following algorithm.
          The algorithm takes a <var>potential URL</var> <a>DOMString</a> as
          input and return either true or an error:
        </p>
        <ol class="algorithm">
          <li>Let <var>url</var> be the result of trying to <a data-lt=
          "URL Parser">parse</a> <var>potential URL</var>. If failure,
          <a>throw</a> a <code>TypeError</code> exception.
          </li>
          <li>If running <a>potentially trustworthy URL</a> with <var>url</var>
          returns <code>"Not Trustworthy"</code>, <a>throw</a> a
          <code>SecurityError</code> exception.
          </li>
          <li>If <a>query</a> is not null or <a>fragment</a> is not null,
          <a>throw</a> <code>TypeError</code> exception.
          </li>
          <li>Return true.
          </li>
        </ol>
      </section>
      <section>
        <h2>
          Matching
        </h2>
        <p>
          The steps to <dfn>determine whether two payment method identifiers
          match</dfn> is given by the following algorithm. The algorithm takes
          two string <var>A</var> and <var>B</var>.
        </p>
        <ol class="algorithm">
          <li>Try to <a>parse</a> <var>A</var> and let <var>urlA</var> be the
          result.
          </li>
          <li>Try to <a>parse</a> <var>B</var> and let <var>urlB</var> be the
          result.
          </li>
          <li>If either <var>urlA</var> or <var>urlB</var> is failure, return
          false.
          </li>
          <li>Try to <a>validate</a> <var>urlA</var> and <var>urlB</var>. If
          either throws, return false.
          </li>
          <li>Return <var>urlA</var> <a>equals</a> <var>urlB</var>.
          </li>
        </ol>
      </section>
    </section>
    <section>
      <h2>
        Standardized Payment Method Identifiers
      </h2>
      <p>
        The <a href="https://w3.org">W3C</a> expects to publish a small number
        of payment method specifications that define abstractions across
        similar payment methods (such as credit card payments, tokenized
        payments, or credit transfers). The <a href="https://w3.org">W3C</a>
        expects these payment methods will be implemented in a wide variety of
        third party payment handlers. The W3C identifies these payment methods
        with (short) strings (individually referred to as a <dfn>standardized
        payment method identifier</dfn>); the W3C expects to mint these strings
        in payment method specifications published by the <a href=
        "https://www.w3.org/Payments/WG/">Web Payments Working Group</a>.
      </p>
      <section>
        <h2>
          Syntax
        </h2>
        <p>
          The syntax of <a>standardized payment method identifier</a> used as
          payment method identifiers is constrained by this regular expression:
        </p>
        <pre>
          [a-z0-9-]+
        </pre>
      </section>
      <section>
        <h2>
          Comparison
        </h2>
        <p>
          For <a>standardized payment method identifier</a>, user agents MUST
          compare strings in a <a data-cite=
          "HTML#case-sensitive">case-sensitive</a> manner (code point for code
          point).
        </p>
      </section>
    </section>
    <section>
      <h2>
        Security consideration
      </h2>
      <p>
        As this specification is reliant on <a>URLs</a>, implementers need to
        be aware of the <a data-cite="!URL#security-considerations">security
        considerations</a> from the [[!URL]] specification.
      </p>
    </section>
    <section>
      <h2>
        Conditional Matching Beyond Payment Method Identifier Matching
      </h2>
      <p>
        For some payment methods, merchants may wish to express that they
        accept a payment method but only under certain conditions (e.g., "I
        only accept credit cards from brand A and debit cards from brand B").
        The <a href="https://www.w3.org/Payments/WG/">Web Payments Working
        Group</a> has discussed several ways to support more sophisticated
        matching beyond initial payment method identifier matching.
      </p>
      <ul>
        <li>Parties may mint payment method identifiers to represent different
        conditions. This scalable approach may work well for a small number of
        independent conditions, but may not scale well for complex
        relationships.
        </li>
        <li>A payment method can define "filters" that enable callers of the
        API to describe in finer detail the conditions under which they accept
        that payment method. User agents and third party payment handlers can
        similarly scope their support for that payment method with these
        filters. In this scenario, a match between payee and payer depends
        first on matching payment method identifiers, then on filter alignment.
        Please note that at this time the Working Group's expectations is that
        filters will be defined within payment methods; there will not be
        "generic" filters that work across payment methods.
        </li>
      </ul>
    </section>
  </body>
</html>
